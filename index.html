<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>טיימר</title>
    <!-- טעינת Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- טעינת גופנים מ-Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cutive+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* הגדרת גופן Assistant כברירת מחדל לטקסט כללי */
        body {
            font-family: 'Assistant', sans-serif;
        }
        /* הסתרת חצים בשדות קלט מספריים מובנים של הדפדפן */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* גופן קבוע לספרות הטיימר */
        #timerDisplay {
            font-family: 'Cutive Mono', monospace; /* הגופן שנבחר */
            font-weight: bold; /* מודגש */
        }
    </style>
</head>
<body class="bg-blue-50 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-6 rounded-3xl shadow-2xl w-full max-w-full lg:max-w-4xl xl:max-w-5xl text-center transform transition-all duration-300 hover:scale-105 border border-gray-100">
        <h1 class="text-3xl font-extrabold text-gray-700 mb-5">טיימר</h1>

        <!-- תצוגת הטיימר -->
        <div id="timerDisplay" class="text-6xl md:text-7xl text-gray-800 mb-5 bg-gray-100 p-4 md:p-6 rounded-2xl border-2 border-gray-200 shadow-inner">
            00:00:00
        </div>

        <!-- קלט זמן בקו ישר (שעות:דקות:שניות) -->
        <div class="flex flex-row justify-center items-center space-x-4 md:space-x-6 mb-6" id="timeInputsContainer">
            <!-- שעות (צד שמאל) -->
            <div class="flex flex-col items-center">
                <label for="hoursInput" class="text-base font-semibold text-gray-600 mb-1">שעות</label>
                <input type="number" id="hoursInput" min="0" max="99" value="0"
                       class="w-20 p-2 text-2xl text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-indigo-300 transition duration-200">
            </div>
            <div class="text-4xl font-bold text-gray-500">:</div>
            <!-- דקות (אמצע) -->
            <div class="flex flex-col items-center">
                <label for="minutesInput" class="text-base font-semibold text-gray-600 mb-1">דקות</label>
                <input type="number" id="minutesInput" min="0" max="59" value="0"
                       class="w-20 p-2 text-2xl text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-indigo-300 transition duration-200">
            </div>
            <div class="text-4xl font-bold text-gray-500">:</div>
            <!-- שניות (צד ימין) -->
            <div class="flex flex-col items-center">
                <label for="secondsInput" class="text-base font-semibold text-gray-600 mb-1">שניות</label>
                <input type="number" id="secondsInput" min="0" max="59" value="0"
                       class="w-20 p-2 text-2xl text-center border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-4 focus:ring-indigo-300 transition duration-200">
            </div>
        </div>

        <!-- כפתורי שליטה -->
        <div class="flex justify-center space-x-4">
            <button id="startButton"
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300 text-xl">
                התחל
            </button>
            <button id="stopButton"
                    class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-200 focus:outline-none focus:ring-4 focus:ring-gray-300 text-xl"
                    disabled>
                עצור
            </button>
            <button id="resetButton"
                    class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition duration-200 focus:outline-none focus:ring-4 focus:ring-red-300 text-xl"
                    disabled>
                אפס
            </button>
        </div>

        <!-- הודעות (לדוגמה, כאשר הטיימר מסתיים) -->
        <div id="messageBox" class="mt-6 p-3 bg-blue-100 text-blue-800 rounded-lg hidden"></div>

    </div>

    <script>
        // אלמנטים מה-DOM
        const timerDisplay = document.getElementById('timerDisplay');
        const hoursInput = document.getElementById('hoursInput');
        const minutesInput = document.getElementById('minutesInput');
        const secondsInput = document.getElementById('secondsInput');
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const resetButton = document.getElementById('resetButton');
        const messageBox = document.getElementById('messageBox');
        const timeInputsContainer = document.getElementById('timeInputsContainer');

        // משתנים גלובליים לטיימר
        let countdownInterval;
        let totalSeconds = 0;
        let isRunning = false;
        let alarmLoop; // משתנה לשמירת לולאת הצלצול

        // אובייקט של צליל אזעקה (Tone.js) - רק מנגינה שמחה
        const alarmSounds = {
            sound5: () => { // מנגינה שמחה
                const synth = new Tone.Synth().toDestination();
                const now = Tone.now();
                synth.triggerAttackRelease("C4", "8n", now);
                synth.triggerAttackRelease("D4", "8n", now + 0.2);
                synth.triggerAttackRelease("E4", "8n", now + 0.4);
                synth.triggerAttackRelease("G4", "8n", now + 0.6);
            }
        };

        // טעינת ספריית Tone.js
        const loadToneJs = () => {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = "https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js";
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        };

        // פונקציה לעדכון תצוגת הטיימר
        function updateDisplay() {
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            timerDisplay.textContent =
                `${String(hours).padStart(2, '0')}:` +
                `${String(minutes).padStart(2, '0')}:` +
                `${String(seconds).padStart(2, '0')}`;
        }

        // פונקציה להצגת הודעה למשתמש
        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800', 'bg-blue-100', 'text-blue-800');
            if (type === 'error') {
                messageBox.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'success') {
                messageBox.classList.add('bg-green-100', 'text-green-800');
            } else {
                messageBox.classList.add('bg-blue-100', 'text-blue-800');
            }
            messageBox.classList.remove('hidden');
        }

        // פונקציה להסתרת הודעה
        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        // פונקציה להפעלת הטיימר
        async function startTimer() {
            if (isRunning) return;

            if (typeof Tone === 'undefined') {
                showMessage('טוען ספריות אודיו...', 'info');
                await loadToneJs();
                await Tone.start();
                hideMessage();
            } else if (Tone.context.state !== 'running') {
                await Tone.start();
            }

            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;

            totalSeconds = (hours * 3600) + (minutes * 60) + seconds;

            if (totalSeconds <= 0) {
                showMessage('אנא הגדר זמן חוקי (גדול מ-0).', 'error');
                return;
            }

            isRunning = true;
            startButton.disabled = true;
            stopButton.disabled = false;
            resetButton.disabled = false;
            hoursInput.disabled = true;
            minutesInput.disabled = true;
            secondsInput.disabled = true;
            hideMessage();

            countdownInterval = setInterval(() => {
                if (totalSeconds <= 0) {
                    clearInterval(countdownInterval);
                    isRunning = false;
                    playAlarm(); // הפעלת הצלצול בלופ
                    showMessage('הזמן נגמר!', 'success');
                    stopButton.disabled = true;
                    return;
                }
                totalSeconds--;
                updateDisplay();
            }, 1000);
        }

        // פונקציה לעצירת הטיימר
        function stopTimer() {
            clearInterval(countdownInterval);
            isRunning = false;
            startButton.disabled = false;
            stopButton.disabled = true;
            resetButton.disabled = false;
            hoursInput.disabled = false;
            minutesInput.disabled = false;
            secondsInput.disabled = false;
            hideMessage();
            if (alarmLoop) { // עצירת לולאת הצלצול
                alarmLoop.stop();
                alarmLoop.dispose();
                alarmLoop = null;
            }
        }

        // פונקציה לאיפוס הטיימר
        function resetTimer() {
            clearInterval(countdownInterval);
            isRunning = false;
            totalSeconds = 0;
            updateDisplay();
            hoursInput.value = 0;
            minutesInput.value = 0;
            secondsInput.value = 0;
            startButton.disabled = false;
            stopButton.disabled = true;
            resetButton.disabled = true;
            hoursInput.disabled = false;
            minutesInput.disabled = false;
            secondsInput.disabled = false;
            hideMessage();
            if (alarmLoop) { // עצירת לולאת הצלצול
                alarmLoop.stop();
                alarmLoop.dispose();
                alarmLoop = null;
            }
        }

        // פונקציה להפעלת צליל האזעקה בלופ
        function playAlarm() {
            // אם לולאה כבר קיימת, עצור אותה וסלק משאבים
            if (alarmLoop) {
                alarmLoop.stop();
                alarmLoop.dispose();
            }

            // יצירת לולאה חדשה שמפעילה את sound5 כל שנייה (או בתדירות המתאימה למנגינה)
            alarmLoop = new Tone.Loop((time) => {
                alarmSounds.sound5(); // הפעלת מנגינה שמחה
            }, "1s").start(0); // לולאה כל שנייה, מתחילה מיד
        }

        // מאזיני אירועים
        startButton.addEventListener('click', startTimer);
        stopButton.addEventListener('click', stopTimer);
        resetButton.addEventListener('click', resetTimer);

        hoursInput.addEventListener('input', updateDisplayFromInput);
        minutesInput.addEventListener('input', updateDisplayFromInput);
        secondsInput.addEventListener('input', updateDisplayFromInput);

        function updateDisplayFromInput() {
            if (isRunning) return;
            const hours = parseInt(hoursInput.value) || 0;
            const minutes = parseInt(minutesInput.value) || 0;
            const seconds = parseInt(secondsInput.value) || 0;
            timerDisplay.textContent =
                `${String(hours).padStart(2, '0')}:` +
                `${String(minutes).padStart(2, '0')}:` +
                `${String(seconds).padStart(2, '0')}`;
        }

        hoursInput.addEventListener('change', (e) => {
            let val = parseInt(e.target.value) || 0;
            if (val < 0) val = 0;
            if (val > 99) val = 99;
            e.target.value = val;
            updateDisplayFromInput();
        });
        minutesInput.addEventListener('change', (e) => {
            let val = parseInt(e.target.value) || 0;
            if (val < 0) val = 0;
            if (val > 59) val = 59;
            e.target.value = val;
            updateDisplayFromInput();
        });
        secondsInput.addEventListener('change', (e) => {
            let val = parseInt(e.target.value) || 0;
            if (val < 0) val = 0;
            if (val > 59) val = 59;
            e.target.value = val;
            updateDisplayFromInput();
        });

        // אתחל תצוגה ראשונית
        updateDisplay();
    </script>
</body>
</html>
